// backend/mock-run-agent.js
// Simple mock run-agent: writes a minimal site into workspacePath so frontend can test editor/preview/export.
const express = require('express');
const fs = require('fs');
const path = require('path');
const bodyParser = require('body-parser');
const app = express();
app.use(bodyParser.json());

app.post('/run-agent', (req, res) => {
  const { workspacePath, template = 'minimal' } = req.body;
  if (!workspacePath) return res.status(400).json({ error: 'workspacePath required' });
  try {
    fs.mkdirSync(workspacePath, { recursive: true });
    if (template === 'react-vite-tailwind') {
      fs.writeFileSync(path.join(workspacePath, 'index.html'),
        '<!doctype html><html><body><h1>Mock React + Vite Template</h1><p>Generated by mock-run-agent</p></body></html>');
      fs.writeFileSync(path.join(workspacePath, 'package.json'),
        JSON.stringify({ name: "mock-react", version: "0.0.0" }, null, 2));
    } else {
      fs.writeFileSync(path.join(workspacePath, 'index.html'),
        '<!doctype html><html><head><meta charset="utf-8"/><title>Mock Minimal</title><link rel="stylesheet" href="./styles.css"></head><body><h1>Mock minimal site</h1><p>Generated by mock-run-agent</p><a class="cta" href="#">CTA</a></body></html>');
      fs.writeFileSync(path.join(workspacePath, 'styles.css'),
        'body{font-family:system-ui;padding:24px;background:#f7f8fb} .cta{display:inline-block;padding:8px 12px;border-radius:8px;background:linear-gradient(90deg,#6366f1,#06b6d4);color:#fff;text-decoration:none;}');
    }
    return res.json({ ok: true, files: ['index.html', 'styles.css'] });
  } catch (err) {
    return res.status(500).json({ error: String(err) });
  }
});

const PORT = 8081;
app.listen(PORT, () => console.log(`Mock run-agent listening on ${PORT}`));
